# í”„ë¡œì íŠ¸ ë¹Œë“œ ë° ë°°í¬

> í”„ë¡œì íŠ¸ì˜ ë¹Œë“œ ë° ë°°í¬ëŠ” Dockerì™€ Jenkins, Nginxë¥¼ í†µí•´ ì´ë£¨ì–´ì¡Œì§€ë§Œ, ì—¬ê¸°ì„œëŠ” Jenkins ì—†ì´ Nginxë¡œ ë°°í¬í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ê¸°ìˆ í•˜ì˜€ìŠµë‹ˆë‹¤.



## ğŸ¨ì‚¬ìš©í•œ ì œí’ˆì˜ ì¢…ë¥˜ì™€ ì„¤ì •ê°’

- JVM: OpenJDK-8
- WEB: Nginx (1.20.1)
- WAS: Gradle
- DB: MySQL (8.0.26 for Linux on x86_64 (MySQL Community Server - GPL))





## ğŸªë¹Œë“œì‹œ ì‚¬ìš©ë˜ëŠ” í™˜ê²½ë³€ìˆ˜ì™€ ì„¤ì •



### .env ë˜ëŠ” .env.production

> root ê²½ë¡œì— ë°±ì—”ë“œ ìš”ì²­ì— ëŒ€í•œ ê²½ë¡œë¥¼ í™˜ê²½ë³€ìˆ˜ë¡œ ë„£ì–´ì¤„ env íŒŒì¼ì„ ì‘ì„±í•©ë‹ˆë‹¤

```
VUE_APP_API_URL=http://<host>/api 
```



###  Database ì ‘ê·¼

> ID: root
>
> PW: ssafy





## ğŸˆë¹Œë“œ ê³¼ì •

í”„ë¡œì íŠ¸ëŠ” docker-compose ë¥¼ ì‚¬ìš©í•´ ë¹Œë“œì´ë¯¸ì§€ë¥¼ ë§Œë“¤ê³  ì»¨í…Œì´ë„ˆë¡œ ë°°í¬í•˜ëŠ” ë°©ì‹ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.




### í”„ë¡œì íŠ¸ í´ë¡ 


```
https://lab.ssafy.com/s05-webmobile1-sub3/S05P13B308.git
```





### ë¹Œë“œ ë° ë°°í¬

>  í”„ë¡œì íŠ¸ì˜ root ê²½ë¡œì— ìˆëŠ” docker-composeë¥¼ ``docker-compose up`` ëª…ë ¹ì–´ë¡œ ì‹¤í–‰í•´ í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œ ë¹Œë“œ ë° ë°°í¬ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.



#### docker-compose.yml

```yaml
version: "3.9"
services: 
  frontend:
    container_name: frontend
    build: 
      context: ./frontend
    ports: 
      - 3000:80
    networks:
      - square4us
    restart: unless-stopped
    depends_on:
      - backend
  backend:
    container_name: backend
    build: 
      context: ./backend
    ports: 
      - 8080:8080
    networks:
      - square4us
    restart: unless-stopped
networks: 
  square4us:
```



#### Frontend

> ë¹Œë“œì—ëŠ” node 12ë²„ì „ì´ ì‚¬ìš©ë˜ì—ˆê³ , ë°°í¬ì—ëŠ” Alpine Linux ê¸°ë°˜ì˜ Nginxì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

```dockerfile
FROM node:12 AS build
WORKDIR /app
COPY package* ./
RUN npm install
COPY public ./public 
COPY src ./src
COPY .env* ./
RUN npm run build
# 2. ë¹Œë“œ ëœ íŒŒì¼ì„ ì—”ì§„ì—‘ìŠ¤ ì»¨í…Œì´ë„ˆì— ë³µì‚¬
FROM nginx:alpine
COPY --from=build /app/dist /usr/share/nginx/html
```



#### Backend

> ë¹Œë“œì—ëŠ” openjdk 8 ë²„ì „ì„ ì‚¬ìš©í•˜ì—¬ gradleë¡œ ë¹Œë“œí•˜ì˜€ê³ , ë°°í¬ì—ëŠ” jre 8ë²„ì „ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

```dockerfile
FROM openjdk:8 AS build
WORKDIR /app
COPY gradlew .
COPY gradle gradle
COPY build.gradle .
COPY settings.gradle .
COPY src src
RUN chmod +x gradlew
RUN ["./gradlew", "clean", "build", "--stacktrace", "--exclude-task", "test"]

FROM openjdk:8-jre-slim
COPY --from=build /app/build/libs/*.jar app.jar
EXPOSE 8080
ENTRYPOINT java -jar app.jar
```







## ğŸƒë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì„¤ì •

> Nginxì˜ ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ í”„ë¡ íŠ¸ì™€ ë°±ì—”ë“œ ìš”ì²­ì„ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤. 
>
> Httpsì˜ ì ìš©ì„ ìœ„í•´ letsencrypt, certbotì„ í™œìš©í–ˆìŠµë‹ˆë‹¤. ìë™ ê°±ì‹ ì€ ë”°ë¡œ ì„¤ì •í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.



#### /etc/nginx/conf.d/default.conf

```bash
server {

        server_name i5b308.p.ssafy.io;

        location / {
            proxy_pass http://127.0.0.1:3000/;
        }

        location /api {
            proxy_pass http://127.0.0.1:8080/api;
        }

        error_page 404 /404.html;
            location = /40x.html {
        }
        error_page 500 502 503 504 /50x.html;
            location = /50x.html {
        }


    listen [::]:443 ssl ipv6only=on;
    listen 443 ssl;
    ssl_certificate /etc/letsencrypt/live/i5b308.p.ssafy.io/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/i5b308.p.ssafy.io/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf; 
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

}
server {
    if ($host = i5b308.p.ssafy.io) {
        return 301 https://$host$request_uri;
    } 


        listen 80 default_server;
        listen [::]:80 default_server;

        server_name i5b308.p.ssafy.io;
    return 404; 


}
```

